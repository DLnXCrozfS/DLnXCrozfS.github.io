<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/08/15/hello-world/"/>
    <url>/2021/08/15/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>安装和运行TIE-GCM</title>
    <link href="/2021/08/15/%E5%AE%89%E8%A3%85%E5%92%8C%E8%BF%90%E8%A1%8CTIE-GCM/"/>
    <url>/2021/08/15/%E5%AE%89%E8%A3%85%E5%92%8C%E8%BF%90%E8%A1%8CTIE-GCM/</url>
    
    <content type="html"><![CDATA[<h2 id="安装环境和-TIE-GCM-版本"><a href="#安装环境和-TIE-GCM-版本" class="headerlink" title="安装环境和 TIE-GCM 版本"></a>安装环境和 TIE-GCM 版本</h2><ul><li>操作系统：CentOS Linux 7 (Core) x86_64</li><li>Shell：bash</li><li>TIE-GCM 版本：1.94</li></ul><h2 id="下载-TIE-GCM-和数据"><a href="#下载-TIE-GCM-和数据" class="headerlink" title="下载 TIE-GCM 和数据"></a>下载 TIE-GCM 和数据</h2><p>TIE-GCM 源代码和数据在 <a href="https://www.hao.ucar.edu/modeling/tgcm/download.php">https://www.hao.ucar.edu/modeling/tgcm/download.php</a> 下载</p><p>以 root 用户登录，新建文件夹 tiegcm1.94 并进入该文件夹中操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir tiegcm1.94<br><span class="hljs-built_in">cd</span> tiegcm1.94<br></code></pre></td></tr></table></figure><p>下载源代码和数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://www.hao.ucar.edu/modeling/tgcm/download/files/tiegcm1.94.tar.gz<br>wget https://www.hao.ucar.edu/modeling/tgcm/download/files/tiegcm1.94_data.tar.gz<br></code></pre></td></tr></table></figure><p>解压源代码和数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -zxf tiegcm1.94.tar.gz<br>tar -zxf tiegcm1.94_data.tar.gz<br></code></pre></td></tr></table></figure><h2 id="下载和安装-Fortran-编译器和-NetCDF"><a href="#下载和安装-Fortran-编译器和-NetCDF" class="headerlink" title="下载和安装 Fortran 编译器和 NetCDF"></a>下载和安装 Fortran 编译器和 NetCDF</h2><p>使用 PGI Fortran 编译器，PGI Fortran 编译器是 NVIDIA HPC SDK 中的一部分</p><p>最新版本的 NVIDIA HPC SDK 在 <a href="https://developer.nvidia.com/nvidia-hpc-sdk-downloads">https://developer.nvidia.com/nvidia-hpc-sdk-downloads</a> 下载</p><p>使用稍早版本（20.7），在 <a href="https://developer.nvidia.com/nvidia-hpc-sdk-releases">https://developer.nvidia.com/nvidia-hpc-sdk-releases</a> 选择并下载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~<br>wget https://developer.download.nvidia.com/hpc-sdk/20.7/nvhpc_2020_207_Linux_x86_64_cuda_11.0.tar.gz<br>tar xpzf nvhpc_2020_207_Linux_x86_64_cuda_11.0.tar.gz<br>sudo nvhpc_2020_207_Linux_x86_64_cuda_11.0/install<br></code></pre></td></tr></table></figure><p>在 ~/.bashrc 文件中为 NVIDIA HPC SDK 中的程序添加环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/.bashrc<br><br><span class="hljs-comment"># 添加内容如下：</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/nvidia/hpc_sdk/Linux_x86_64/20.7/compilers/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/opt/nvidia/hpc_sdk/Linux_x86_64/20.7/compilers/bin<br><br><span class="hljs-comment"># 保存退出后重新执行 ~/.bashrc 文件</span><br><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><p>注意：如果安装了不同版本的 NVIDIA HPC SDK，或指定了不同的安装位置，则需要修改上述路径</p><p>接着安装 NetCDF，推荐使用 yum 包管理器安装，可以方便地解决依赖和版本问题</p><p>首先为 yum 添加 EPEL 源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y epel-release<br></code></pre></td></tr></table></figure><p>安装 netcdf-devel 和 netcdf-fortran：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install netcdf-devel<br>yum install netcdf-fortran<br></code></pre></td></tr></table></figure><p>NetCDF 4.2 版本以上，NetCDF-C 和 NetCDF-Fortran 是分开的。需要先安装 NetCDF-C，再安装 NetCDF-Fortran。有关 NetCDF 的详细信息，可以参阅 <a href="https://www.unidata.ucar.edu/software/netcdf/docs/building_netcdf_fortran.html">https://www.unidata.ucar.edu/software/netcdf/docs/building_netcdf_fortran.html</a></p><p>NetCDF 官网 <a href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a> 推荐使用源码编译安装，但这种方式需要提前安装 zlib、HDF5 和 curl 等依赖，且编译过程复杂、可能报错。使用 yum 包管理器安装 NetCDF 时，能自动安装依赖项</p><h2 id="配置-TIE-GCM"><a href="#配置-TIE-GCM" class="headerlink" title="配置 TIE-GCM"></a>配置 TIE-GCM</h2><p>进入 TIE-GCM 的安装文件夹 tiegcm1.94，里面应当至少有同名文件夹 tiegcm1.94 及数据文件夹 tiegcm1.94_data —— “安装文件夹”指代前者，而 “模型文件夹” 指代后者。例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/root/Desktop/tiegcm1.94<span class="hljs-comment">#安装文件夹的绝对路径</span><br>/root/Desktop/tiegcm1.94/tiegcm1.94<span class="hljs-comment">#模型文件夹的绝对路径</span><br></code></pre></td></tr></table></figure><p>首先在 ~/.bashrc 中指定数据文件夹的位置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/.bashrc<br><br><span class="hljs-comment"># 添加内容如下：</span><br><span class="hljs-built_in">export</span> TGCMDATA=<span class="hljs-variable">$PATH</span>:/root/Desktop/tiegcm1.94/tiegcm1.94_dataTGCMDATA=/root/Desktop/tiegcm1.94/tiegcm1.94_data<br><br><span class="hljs-comment"># 保存退出后重新执行 ~/.bashrc 文件</span><br><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><p>注意：如果安装位置不同，或者数据放在了其它位置，则需要修改上述路径</p><p>修改 TIE-GCM 的 Make 配置文件 Make.pgi_hao64，这个文件在模型文件夹tiegcm1.94/scripts/Make.pgi_hao64：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim Make.pgi_hao64<br><br><span class="hljs-comment"># 修改如下内容：</span><br>F90      = /opt/nvidia/hpc_sdk/Linux_x86_64/20.7/compilers/bin/pgf90<br>MPIF90   = /opt/nvidia/hpc_sdk/Linux_x86_64/20.7/comm_libs/mpi/bin/mpif90<br>MPIRUN   = /opt/nvidia/hpc_sdk/Linux_x86_64/20.7/comm_libs/mpi/bin/mpirun<br><br>LIBS     = -lhdf5_hl -lhdf5 -lsz -L/usr/lib64 -lz -lnetcdff<br><br>LIB_NETCDF = /usr/libINC_NETCDF = /usr/include<br></code></pre></td></tr></table></figure><p>注意：如果 NVIDIA HPC SDK 或 NetCDF 的安装位置不同，则需要修改上述路径</p><p>回到安装文件夹内，修改 tiegcm-linux.job 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim tiegcm-linux.job<br><span class="hljs-comment"># 修改如下内容：</span><br><span class="hljs-built_in">set</span> modeldir = /root/Desktop/tiegcm1.94/tiegcm1.94<br><span class="hljs-built_in">set</span> make     = /root/Desktop/tiegcm1.94/tiegcm1.94/scripts/Make.pgi_hao64<br><span class="hljs-built_in">set</span> input    = /root/Desktop/tiegcm1.94/tiegcm1.94/scripts/tiegcm_default.inp<br><span class="hljs-built_in">set</span> mpi      = FALSE<br></code></pre></td></tr></table></figure><p>注意：如果安装位置不同，则需要修改上述路径</p><p>mpi 不建议使用 root 身份运行，否则将报错，所以此处设置为 FALSE</p><h2 id="运行-TIE-GCM"><a href="#运行-TIE-GCM" class="headerlink" title="运行 TIE-GCM"></a>运行 TIE-GCM</h2><p>在安装文件夹内，执行 tiegcm-linux.job 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./tiegcm-linux.job<br></code></pre></td></tr></table></figure><p>模型将使用 PGI Fortran 编译器编译、链接、运行并生成输出，该过程可能耗时数分钟</p><p>完成后，在安装文件夹内将生成新文件夹 tiegcm-linux 和一个输出文件 tiegcm.out</p><p>注意：如果在编译等环节报错，调整配置后重新运行 tiegcm-linux.job 文件，建议先删除文件夹 tiegcm-linux 和输出文件 tiegcm.out</p><p>如果程序正常运行，tiegcm.out 文件的末尾会含有 NORMAL EXIT 字样</p><h2 id="为非-root-用户安装和运行-TIE-GCM"><a href="#为非-root-用户安装和运行-TIE-GCM" class="headerlink" title="为非 root 用户安装和运行 TIE-GCM"></a>为非 root 用户安装和运行 TIE-GCM</h2><p>以非 root 用户运行 TIE-GCM 可以使用 mpi 做并行计算，安装和运行方法与上述各节所述类似，请注意替换相应的路径，并视需要在各项命令前添加 <code>sudo</code></p><p>非 root 用户开启 mpi，需要修改安装文件夹内的 tiegcm-linux.job 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim tiegcm-linux.job<br><span class="hljs-comment"># 除修改“配置 TIE-GCM”一节中所述内容外，还需要修改如下内容：</span><br><span class="hljs-built_in">set</span> mpi      = TRUE<br><span class="hljs-built_in">set</span> nproc    = 4<br><span class="hljs-comment"># nproc 一项可以指定并行计算使用的核心数量</span><br></code></pre></td></tr></table></figure><p>同样地，如果程序正常运行，tiegcm.out 文件的末尾会含有 NORMAL EXIT 字样</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
